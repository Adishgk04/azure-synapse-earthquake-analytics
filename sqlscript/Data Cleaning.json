{
	"name": "Data Cleaning",
	"properties": {
		"content": {
			"query": "\nSELECT TOP 100 * FROM dbo.earthquake_stg\nGO \n\n \nSELECT count(*) FROM dbo.earthquake_stg \n \n\n drop view silver.eartquake_data\n\n\n\nCREATE VIEW silver.eartquake_data AS\nSELECT CASE WHEN CHARINDEX(',',REVERSE(PLACE))>0 THEN RIGHT(PLACE,CHARINDEX(',',REVERSE(PLACE))-1) \n        ELSE RIGHT(PLACE,CHARINDEX(',',REVERSE(PLACE))) END AS EQ_PLACE,\n        LEFT(PLACE, LEN(PLACE)-CHARINDEX(',',REVERSE(PLACE))) AS LOCATION,\n        convert(date,dateadd(ms,CAST(time AS BIGINT),'1970-01-01'),103) as TIMES,\n        convert(date,dateadd(ms,CAST(updated AS BIGINT),'1970-01-01'),103) as UPDATED_TIME,\n        TRY_CAST(MAG AS FLOAT) AS MAG, \n        TRY_CAST(FELT AS FLOAT) AS FELT, \n        TRY_CAST(CDI AS FLOAT) AS CDI, \n        TRY_CAST(MMI AS FLOAT) AS MMI, \n\tALERT ,\n\tSTATUS ,\n        TRY_CAST(TSUNAMI AS INT) AS TSUNAMI, \n        TRY_CAST(SIG AS FLOAT) AS SIG, \n        TRY_CAST(NET AS FLOAT) AS NET,  \n        TRY_CAST(NST AS FLOAT) AS NST, \n        TRY_CAST(DMIN AS FLOAT) AS DMIN,  \n        TRY_CAST(RMS AS FLOAT) AS RMS, \n        TRY_CAST(GAP AS FLOAT) AS GAP, \n        TRY_CAST(LONGITUDE AS FLOAT) AS LONGITUDE,  \n        TRY_CAST(LATITUDE AS FLOAT) AS LATITUDE, \n        TRY_CAST(DEPTH AS FLOAT) AS DEPTH \nFROM dbo.earthquake_stg \nWHERE PLACE<>'PLACE' \n\n\n\nselect count(distinct eq_place) from silver.eartquake_data\nwhere felt>=500\n\n\n\n\n\nselect distinct alert from silver.eartquake_data\n\n\n\nselect count(case when alert='red' then 1 else null end) as Red,\ncount(case when alert='orange' then 1 else null end) as Orange,\ncount(case when alert='yellow' then 1 else null end) as Yellow,\ncount(case when alert='green' then 1 else null end) as Green,\ncount(case when alert is NULL then 1 else null end) as Unknown\nfrom silver.eartquake_data  \n\n\n--Time Period\nselect max(times),min(updated_time) \nFROM silver.eartquake_data\n\n\n\n\n\n\n\nselect top 5 DATENAME(month,TIMES),* from silver.eartquake_data\nwhere alert is not null\n\n\n--Time Period\nselect max(times),min(updated_time) \nFROM silver.eartquake_data\n\n\n-- Order by Earthquake count \nselect eq_place,count( eq_place) as eq_count from silver.eartquake_data\ngroup by eq_place\norder by eq_count desc\n\n\n-- Order by Earthquake count magnitude above 4\nselect eq_place,count( eq_place) as eq_count from silver.eartquake_data\nwhere mag>4.5\ngroup by eq_place\norder by eq_count desc \n\n\n\n\n\nCREATE VIEW silver.clean_eartquake_data AS\nSELECT  ISNULL(EQ_PLACE,'Unknown') as Region, ISNULL(LOCATION,'Unknown') as Location,TIMES,UPDATED_TIME,\n        TRY_CAST(MAG AS FLOAT) AS MAG, \n        TRY_CAST(FELT AS FLOAT) AS FELT, \n        TRY_CAST(CDI AS FLOAT) AS CDI, \n        TRY_CAST(MMI AS FLOAT) AS MMI, \n\tALERT ,\n\tSTATUS ,\n        TRY_CAST(TSUNAMI AS INT) AS TSUNAMI, \n        TRY_CAST(SIG AS FLOAT) AS SIG, \n        TRY_CAST(NET AS FLOAT) AS NET,  \n        TRY_CAST(NST AS FLOAT) AS NST, \n        TRY_CAST(DMIN AS FLOAT) AS DMIN,  \n        TRY_CAST(RMS AS FLOAT) AS RMS, \n        TRY_CAST(GAP AS FLOAT) AS GAP, \n        TRY_CAST(LONGITUDE AS FLOAT) AS LONGITUDE,  \n        TRY_CAST(LATITUDE AS FLOAT) AS LATITUDE, \n        TRY_CAST(DEPTH AS FLOAT) AS DEPTH \nFROM silver.eartquake_data\nWHERE mag is not null and LONGITUDE is not null and LATITUDE is not null and DEPTH is not null\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "Earthquake",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}
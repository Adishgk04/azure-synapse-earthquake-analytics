{
	"name": "data transformation",
	"properties": {
		"content": {
			"query": "CREATE SCHEMA GOLD;\n\ndrop view gold.yearly_eq_summary\ndrop view gold.yearly_eq_bucket\ndrop view gold.yearly_eq_summary\ndrop view gold.yearly_eq_summary\n\nCREATE VIEW gold.yearly_eq_summary AS\nselect DATEPART(YEAR,Times) as YEAR, count(*) as Total_earthquake,\ncount(case when mag>6.5 then 1 else null end) as Major_earthquake,\ncount(case when mag>0 and mag<=6.5 then 1 else null end) as Minor_earthquake, \ncount(case when tsunami=1 then 1 else null end ) as Tsuanmi_count,\ncount(case when tsunami=1 and mag>6 then 1 else null end ) as [Earthquake and Tsuanmi_count] \nfrom silver.clean_eartquake_data\ngroup by DATEPART(YEAR,Times) \n\n \n\nCREATE VIEW gold.monthly_eq_summary AS\nselect \nDATEPART(YEAR,Times) as YEAR, count(*) as Yearly_earthquake,DATENAME(MONTH,Times) as MONTH, count(*) as Monthly_earthquake,\ncount(case when mag>6 then 1 else null end) as Major_earthquake,\ncount(case when mag>0 and mag<=6 then 1 else null end) as Minor_earthquake, \ncount(case when tsunami=1 then 1 else null end ) as Tsuanmi_count,\ncount(case when tsunami=1 and mag>6 then 1 else null end ) as [Earthquake and Tsuanmi_count],\nSUM(CASE WHEN DEPTH < 70 THEN 1 else 0 END) AS shallow_quakes,\nSUM(CASE WHEN DEPTH BETWEEN 70 AND 300 THEN 1 else 0 END) AS intermediate_quakes,\nSUM(CASE WHEN DEPTH > 300 THEN 1 else 0 END) AS deep_quakes,\nconvert( decimal(10,2),AVG(DEPTH)) AS Avg_depth,\nconvert( decimal(10,2),AVG(SIG)) AS Avg_significance\nfrom silver.clean_eartquake_data\ngroup by DATENAME(MONTH,Times),DATEPART(YEAR,Times)\n\n \n\n\nCREATE VIEW gold.Daily_eq_summary AS\nselect TIMES,\ncount(case when mag>5 then 1 else null end) as Major_earthquake,\ncount(case when mag>0 and mag<=5 then 1 else null end) as Minor_earthquake, \ncount(case when tsunami=1 then 1 else null end ) as Tsuanmi_count,\nSUM(CASE WHEN DEPTH < 70 THEN 1 else 0 END) AS shallow_quakes,\nSUM(CASE WHEN DEPTH BETWEEN 70 AND 300 THEN 1 else 0 END) AS intermediate_quakes,\nSUM(CASE WHEN DEPTH > 300 THEN 1 else 0 END) AS deep_quakes,\nconvert( decimal(10,2),AVG(DEPTH)) AS Avg_depth,\nconvert( decimal(10,2),AVG(SIG)) AS Avg_significance,\ncount(case when tsunami=1 and mag>6 then 1 else null end ) as [Earthquake and Tsuanmi_count] \nfrom silver.clean_eartquake_data\ngroup by TIMES\n\n\n\nCREATE VIEW gold.gold_magnitude_categories AS\nSELECT\n    CASE \n        WHEN MAG < 4 THEN 'Minor'\n        WHEN MAG BETWEEN 4 AND 4.9 THEN 'Light'\n        WHEN MAG BETWEEN 5 AND 5.9 THEN 'Moderate'\n        WHEN MAG BETWEEN 6 AND 6.9 THEN 'Strong'\n        WHEN MAG >= 7 THEN 'Major'\n    END AS magnitude_category,\n    COUNT(*) AS total_events,\n    AVG(SIG) AS avg_significance\nFROM silver.clean_eartquake_data\nWHERE MAG IS NOT NULL\nGROUP BY CASE \n        WHEN MAG < 4 THEN 'Minor'\n        WHEN MAG BETWEEN 4 AND 4.9 THEN 'Light'\n        WHEN MAG BETWEEN 5 AND 5.9 THEN 'Moderate'\n        WHEN MAG BETWEEN 6 AND 6.9 THEN 'Strong'\n        WHEN MAG >= 7 THEN 'Major'\n    END;\n  \n\n\nCREATE VIEW GOLD.yearly_alert AS\nSELECT DATEPART(year,times) as year, \nCOUNT(CASE when alert='green' then 1 else null end) as green_alert,\nCOUNT(CASE when alert='yellow' then 1 else null end) as yellow_alert,\nCOUNT(CASE when alert='orange' then 1 else null end) as orange_alert,\nCOUNT(CASE when alert='red' then 1 else null end) as red_alert,\nCOUNT(CASE when alert is NULL then 1 else null end) as [unidentified]\nfrom silver.clean_eartquake_data\ngroup by DATEPART(year,times)\n\n\n\n\nCREATE VIEW gold.eq_region_summary AS\nselect region, count(mag) as magnitude_count, AVG(mag) as Average_magnitude,max(mag) as Maxium_magnitude,min(mag) as Minimum_magnitude,\nCOUNT(CASE when alert='green' then 1 else null end) as green_alert,\nCOUNT(CASE when alert='yellow' then 1 else null end) as yellow_alert,\nCOUNT(CASE when alert='orange' then 1 else null end) as orange_alert,\nCOUNT(CASE when alert='red' then 1 else null end) as red_alert\nfrom silver.clean_eartquake_data\nwhere felt>=500\nand mag>6\ngroup by region\norder by Maxium_magnitude DESC\n\n\n\n\n\nCREATE VIEW gold.eq_region_eq_summary AS\nselect Region,\ncount(case when mag>5 then 1 else null end) as Major_earthquake,\ncount(case when mag>0 and mag<=5 then 1 else null end) as Minor_earthquake, \ncount(case when tsunami=1 then 1 else null end ) as Tsuanmi_count,\nSUM(CASE WHEN DEPTH < 70 THEN 1 else 0 END) AS shallow_quakes,\nSUM(CASE WHEN DEPTH BETWEEN 70 AND 300 THEN 1 else 0 END) AS intermediate_quakes,\nSUM(CASE WHEN DEPTH > 300 THEN 1 else 0 END) AS deep_quakes,\nmax(mag) AS Maxium_magnitude,\nmin(mag) AS Minimum_magnitude,\nconvert( decimal(10,2),AVG(DEPTH)) AS Avg_depth,\nconvert( decimal(10,2),AVG(SIG)) AS Avg_significance,\nsum(felt) as Total_felt,\navg(felt) as Avg_felt\nfrom silver.clean_eartquake_data\ngroup by region  \norder by Avg_significance desc\n\n\n\nCREATE VIEW gold.gold_high_impact_regions AS\nSELECT\n    COALESCE(region, 'Unknown Region') AS region_name,\n\n    -- Count major or significant events\n    SUM(\n        CASE WHEN \n            MAG >= 6 \n            OR SIG >= 600\n            OR (MAG >= 5 AND DEPTH < 20)\n            OR TSUNAMI = 1\n        THEN 1 ELSE 0 END\n    ) AS high_impact_quake_count,\n\n    -- Important descriptive metrics\n    AVG(SIG) AS avg_significance,\n    MAX(SIG) AS max_significance,\n\n    -- Shallow strong events (biggest shaking)\n    SUM(CASE WHEN MAG >= 5 AND DEPTH < 70 THEN 1 ELSE 0 END) AS shallow_strong_quakes,\n\n    -- Tsunami-generating events\n    SUM(CASE WHEN TSUNAMI = 1 THEN 1 ELSE 0 END) AS tsunami_events,\n\n    -- Magnitude distribution\n    MAX(MAG) AS maximum_magnitude,\n    AVG(MAG) AS avg_magnitude,\n\n    -- Depth distribution\n    AVG(DEPTH) AS avg_depth\nFROM silver.clean_eartquake_data\nWHERE MAG IS NOT NULL\nGROUP BY COALESCE(region, 'Unknown Region')\norder by max_significance\n\n\nselect * from GOLD.yearly_alert\norder by year\n\nselect * from gold.yearly_eq_summary\norder by year",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "Earthquake",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}